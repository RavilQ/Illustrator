@using Illustration.Enum

@model ProfileViewModel

@{
    var start = DateTime.UtcNow.AddHours(4);
    //var oldDate = DateTime.Parse("02/25/2023 03:40:31");
}

    <main>
        <section style="background-color: #131313;position: relative;bottom: 3.5rem;">
            <h1 class="container" style="max-width: 90%;">My Account</h1>
        </section>
        <section class="container" style="padding-bottom: 10rem;max-width: 90%;">
            <div style="--bs-gutter-x:0;" class="row">
                <div class="col-4">
                    <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <a class="my-account-tabs nav-link" id="v-pills-home-tab" data-bs-toggle="pill" href="#v-pills-home" role="tab" aria-controls="v-pills-home" aria-selected="true">Dashboard</a>
                        <a class="my-account-tabs nav-link" id="v-pills-home-tab" data-bs-toggle="pill" href="#v-pills-contactmessages-tab" role="tab" aria-controls="v-pills-home" aria-selected="true">Messages</a>
                        <a class="my-account-tabs nav-link" id="v-pills-profile-tab" data-bs-toggle="pill" href="#v-pills-profile" role="tab" aria-controls="v-pills-profile" aria-selected="false">Orders</a>
                        <a class="my-account-tabs nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" href="#v-pills-wishlist" role="tab" aria-controls="v-pills-settings" aria-selected="false">Wishlist</a>
                        <a class="my-account-tabs nav-link active" id="v-pills-messages-tab" data-bs-toggle="pill" href="#my-v-pills-messages" role="tab" aria-controls="v-pills-messages" aria-selected="false">Portraits</a>
                        <a class="my-account-tabs nav-link" id="v-pills-messages-tab" data-bs-toggle="pill" href="#v-pills-details" role="tab" aria-controls="v-pills-messages" aria-selected="false">Account Details</a>
                        <a class="my-account-tabs nav-link" id="v-pills-messages-tab" data-bs-toggle="pill" href="#v-pills-sale" role="tab" aria-controls="v-pills-messages" aria-selected="false">Sale</a>
                        <a class="my-account-tabs nav-link"asp-action="Logout">Log Out</a>
                    </div>
                </div>
                <div class="col-8">
                    <div class="tab-content" id="v-pills-tabContent">
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
                            <h3 id="alo3333">
                                Dashboard
                            </h3>
                            <hr>
                            <p style="color: #212529;">Hello, @User.Identity.Name (If Not @User.Identity.Name !Logout)</p>
                            From your account dashboard. you can easily check & view your recent orders, manage your shipping and billing addresses and edit your password and account details.
                        </div>
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade" id="v-pills-contactmessages-tab" role="tabpanel" aria-labelledby="v-pills-home-tab">
                            <h3 id="alo3333">
                                Messages
                            </h3>
                            <hr>
                              @*@foreach (var item in Model.Messages)
                              {
                                var alma = item.CreatAt;
                                <a style="text-decoration:none;color:black;" href="#">
                                    <div class="card">
                                        <div style="display: flex;">
                                            <div style=" display: flex;align-items: center;">
                                                <img style="border-radius: 50%;width: 74%;margin-left: 10%;" src="~/Uploads/Users/4f64c9f81bb0d4ee969aaf7b4a5a6f40.png" class="" alt="card-horizontal-image">
                                            </div>
                                            <div>
                                                <div>
                                                    @if (item.Text.Length > 38)
                                                    {
                                                        <h5>@item.Text.Substring(0, 38) ...</h5>
                                                    }
                                                    else
                                                    {
                                                        <h5>@item.Text</h5>
                                                    }
                                                    @if ((start - alma).Days >= 1)
                                                    {
                                                        <p><small class="text-muted">@((start - alma).Days) days ago</small></p>
                                                    }
                                                    else if ((start - alma).Hours >= 1)
                                                    {
                                                        <p><small class="text-muted">@((start - alma).Hours) hours ago</small></p>
                                                    }
                                                    else
                                                    {
                                                        <p><small class="text-muted">@((start - alma).Minutes) mins ago</small></p>
                                                    }

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>                     
                              }*@

                              @await Html.PartialAsync("_inboxMessagesPartial",Model.Messages)
                        </div>
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
                            <div class="row">
                                <div class="d-flex justify-content-between">
                                <h3>All Order Portraits<span>( @Model.MyOrders.Count )</span></h3>
                                </div>
                                <hr />
                                @foreach (var item in Model.MyOrders)
                                {
                                    <div style="border-bottom: 1px solid black;padding: 3rem;align-items: center;text-align: center;" class="row row-cols-5">
                                    <img src="~/Uploads/Portraits/@item.Portrait.PortraitImages.FirstOrDefault(x=>x.ImageStatus==true).Image" alt="">
                                    <h3>@item.Portrait.Name</h3>
                                    <div>@item.CreatAt</div>
                                    <div>$@item.Portrait.SalePrice</div>
                                    <div><span class="badge bg-dark">@item.Status</span></div>
                                    </div>
                                }
                            </div>
                        </div>
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade" id="v-pills-wishlist" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                            @await Html.PartialAsync("_profileWishlistPartial",Model.WishListItem)
                        </div>
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade show active" id="my-v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                            <!-- <div class="l-container">
                                <div class="b-game-card">
                                  <div class="b-game-card__cover" style="background-image: url(/assets/images/rosee3.jpg);"></div>
                                </div>
                                <div class="b-game-card">
                                  <div class="b-game-card__cover" style="background-image: url(/assets/images/jisoo3.jpg);"></div>
                                </div>
                                <div class="b-game-card">
                                  <div class="b-game-card__cover" style="background-image: url(/assets/images/lalisa.jpg);"></div>
                                </div>
                                <div class="b-game-card">
                                  <div class="b-game-card__cover" style="background-image: url(/assets/images/jennie2.jpg);"></div>
                                </div>
                            </div> -->


                            <div class="wrapper">
                            <div class="d-flex justify-content-between">
                                <h3>All Portraits<span>( @Model.Portraits.Count )</span></h3>
                                <a asp-action="Create" class="btn btn-dark">Add Portrait</a>
                            </div>
                            <hr />

                                <div style="width: 109%;" class="cards">
                                    @foreach (var portrait in Model.Portraits)
                                    {
                                        if (portrait.StockStatus)
                                        {
                                          <figure class="card">

                                            <img src="~/Uploads/Portraits/@portrait.PortraitImages.FirstOrDefault(x=>x.ImageStatus==true).Image" />

                                            <figcaption><a asp-controller="Auktion" asp-action="Index" asp-route-id="@portrait.Id"><i class="las la-gavel"></i></a><a asp-controller="Portrait" asp-action="Detail" asp-route-id="@portrait.Id"><i class="las la-info-circle"></i></a> <a asp-action="Edit" asp-route-id="@portrait.Id"><i style="line-height: unset;" class="las la-pen"></i></a><a class="myaccount-delete-icon-a" asp-action="Delete" asp-route-id="@portrait.Id"><i style="line-height: unset;" class="las la-minus-circle"></i></a></figcaption>

                                          </figure>
                                        }

                                    }    
                                   

                             @*       <figure class="card">

                                        <img src="~/assets/images/realistic1.jpg" />

                                        <figcaption><a href="#"><i class="las la-info-circle"></i></a> <a href="#"><i style="line-height: unset;" class="las la-pen"></i></a><a id="myaccount-delete-icon-a" href="#"><i style="line-height: unset;" class="las la-minus-circle"></i></a></figcaption>

                                    </figure>

                                    <figure class="card">

                                        <img src="~/assets/images/batman2.jpg" />

                                        <figcaption><a href="#"><i class="las la-info-circle"></i></a> <a href="#"><i style="line-height: unset;" class="las la-pen"></i></a><a id="myaccount-delete-icon-a" href="#"><i style="line-height: unset;" class="las la-minus-circle"></i></a></figcaption>

                                    </figure>*@


                                </div>



                            </div>
                        </div>
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade" id="v-pills-sale" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                        <div class="col-lg-12 grid-margin stretch-card">

                            <div>
                                <h4 class="card-title">Sale Portraits</h4>
                                <div class="table-responsive">
                                    <table class="table">

                                        <thead>
                                            <tr>

                                                <th> Client Name </th>
                                                <th> Product Price </th>
                                                <th> Portrait Name </th>
                                                <th> Start Date </th>
                                                <th> Order Status </th>
                                                <th> Actions </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in Model.SaleOrders)
                                            {
                                                <tr>

                                                    <td>
                                                        <span class="pl-2">@item.AppUser.Fullname</span>
                                                    </td>
                                                    <td> $@(((item.Portrait.SalePrice * (100 - item.Portrait.DiscountPercent) / 100)).ToString("0.00")) </td>
                                                    <td> @item.Portrait.Name </td>
                                                    <td> @item.CreatAt </td>
                                                    <td>
                                                        <div class="badge bg-dark">@item.Status</div>
                                                    </td>
                                                    @if (item.Status != OrderStatus.Pending)
                                                    {
                                                        <td>
                                                            <button type="button" class="btn btn-dark disabled">Edit</button>
                                                        </td>
                                                    }
                                                    else
                                                    {
                                                        <td>
                                                            <a asp-action="SaleOrderEdit" asp-route-id="@item.Id" type="button" class="btn btn-dark">Edit</a>
                                                        </td>
                                                    }

                                                </tr>
                                            }

                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </div>
                        </div>
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade" id="v-pills-details" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                            <h3>
                                Account Details
                            </h3>
                            <hr>
                           @await Html.PartialAsync("_accountDetails",Model.ViewModel)
                        </div>

                    </div>
                </div>
        </section>
    </main>


   
    <script>
        ScrollReveal().reveal('.headline');

        function handleFileSelect(evt) {
            var file = evt.target.files; // FileList object
            var f = file[0];
            // Only process image files.
            if (!f.type.match('image.*')) {
                alert("Image only please....");
            }
            var reader = new FileReader();
            // Closure to capture the file information.
            reader.onload = (function (theFile) {
                return function (e) {
                    // Render thumbnail.
                    //var span = document.createElement('span');
                    //span.innerHTML = ['<img style="width: 10rem;margin-bottom: 15px;border-radius: 16%; " class="thumb" title="', escape(theFile.name), '" src="', e.target.result, '" />'].join('');
                    //document.getElementById('output').insertBefore(span, null);
                    document.getElementById('myOutput').innerHTML = ['<img style="width: 25%;margin-bottom: 15px;border-radius: 16%; " class="thumb" title="', escape(theFile.name), '" src="', e.target.result, '" />'].join('');
                };
            })(f);
            // Read in the image file as a data URL.
            reader.readAsDataURL(f);
        }
        document.getElementById('formFileMultiple').addEventListener('change', handleFileSelect, false);


    function handleFileSelectt(event) {
        //Check File API support
        if (window.File && window.FileList && window.FileReader) {

            var files = event.target.files; //FileList object
            var output = document.getElementById("myManyOutput");

            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                //Only pics
                if (!file.type.match('image')) continue;

                var picReader = new FileReader();
                picReader.addEventListener("load", function (event) {
                    var picFile = event.target;
                    var div = document.createElement("div");
                    document.getElementById("myManyOutput").innerHTML += "<img class='thumbnail my-first-backend-class' src='" + picFile.result + "'" + "title='" + file.name + "'/>";
                    output.insertBefore(div, null);
                });
                //Read the image
                picReader.readAsDataURL(file);
            }
        } else {
            console.log("Your browser does not support File API");
        }
    }

    document.querySelector('.formFileMultiple2').addEventListener('change', handleFileSelectt, false);

    </script>

   
@section Scripts{
    <script>


        let connection = new signalR.HubConnectionBuilder().withUrl("/illustratorhub").build();

        connection.start().then(function () {

        })

        document.getElementById("userMessageSenderinmine").addEventListener("click", function (e) {
            e.preventDefault();
            var message = document.getElementById("usermessageinput").value;
            var name = "Elariz"
            connection.invoke("SendMessageUser", name, message);

            var link = `/Account/InboxMessageSend?MyMessage=${message}`

            fetch(link)
                .then(response => {
                    return response.text();
                }).then(html => {

                })
        })

        connection.on("RecieveMessage", function (name, message) {
            var destination = document.getElementById("usermessageinboxconfirm");
            var image = document.getElementById("usermessageimagesend").value;
            destination.innerHTML += ` <div class="chat-message-right pb-4">
                                                <div class="ms-2">
                                                    <img src="/Uploads/Users/${image}" class="rounded-circle mr-1" alt="Chris Wood" width="40" height="40">
                                                </div>
                                                <div style="display: flex;align-items: center;" class="flex-shrink-1 bg-light rounded py-2 px-3 mr-3">
                                                   ${message}
                                                </div>
                                            </div>
                `
            document.getElementById('usermessageinput').value = "";
        })


        connection.on("RecievMessage", function (name, message) {
            var destination = document.getElementById("usermessageinboxconfirm");
            destination.innerHTML += `  <div class="chat-message-left pb-4">
                                                <div class="me-2">
                                                    <img src="/assets/images/4f64c9f81bb0d4ee969aaf7b4a5a6f40.png" class="rounded-circle mr-1" alt="Sharon Lessman" width="40" height="40">
                                                </div>
                                                <div class="flex-shrink-1 bg-light rounded py-2 px-3 ml-3">
                                                    <div class="font-weight-bold mb-1">Admin</div>
                                                    ${message}
                                                </div>
                                            </div>
                `
        })

    </script>
}