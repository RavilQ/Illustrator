@using Illustration.Enum

@model ProfileViewModel

    <main>
        <section style="background-color: #131313;position: relative;bottom: 3.5rem;">
            <h1 class="container" style="max-width: 90%;">My Account</h1>
        </section>
        <section class="container" style="padding-bottom: 10rem;max-width: 90%;">
            <div style="--bs-gutter-x:0;" class="row">
                <div class="col-4">
                    <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <a class="my-account-tabs nav-link" id="v-pills-home-tab" data-bs-toggle="pill" href="#v-pills-home" role="tab" aria-controls="v-pills-home" aria-selected="true">Dashboard</a>
                        <a class="my-account-tabs nav-link" id="v-pills-home-tab" data-bs-toggle="pill" href="#v-pills-contactmessages-tab" role="tab" aria-controls="v-pills-home" aria-selected="true">Messages</a>
                        <a class="my-account-tabs nav-link" id="v-pills-profile-tab" data-bs-toggle="pill" href="#v-pills-profile" role="tab" aria-controls="v-pills-profile" aria-selected="false">Orders</a>
                        <a class="my-account-tabs nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" href="#v-pills-wishlist" role="tab" aria-controls="v-pills-settings" aria-selected="false">Wishlist</a>
                        <a class="my-account-tabs nav-link active" id="v-pills-messages-tab" data-bs-toggle="pill" href="#my-v-pills-messages" role="tab" aria-controls="v-pills-messages" aria-selected="false">Portraits</a>
                        <a class="my-account-tabs nav-link" id="v-pills-messages-tab" data-bs-toggle="pill" href="#v-pills-details" role="tab" aria-controls="v-pills-messages" aria-selected="false">Account Details</a>
                        <a class="my-account-tabs nav-link" id="v-pills-messages-tab" data-bs-toggle="pill" href="#v-pills-sale" role="tab" aria-controls="v-pills-messages" aria-selected="false">Sale</a>
                        <a class="my-account-tabs nav-link"asp-action="Logout">Log Out</a>
                    </div>
                </div>
                <div class="col-8">
                    <div class="tab-content" id="v-pills-tabContent">
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
                            <h3 id="alo3333">
                                Dashboard
                            </h3>
                            <hr>
                            <p style="color: #212529;">Hello, @User.Identity.Name (If Not @User.Identity.Name !Logout)</p>
                            From your account dashboard. you can easily check & view your recent orders, manage your shipping and billing addresses and edit your password and account details.
                        </div>
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade" id="v-pills-contactmessages-tab" role="tabpanel" aria-labelledby="v-pills-home-tab">
                            <h3 id="alo3333">
                                Messages
                            </h3>
                            <hr>
                    
                              @await Html.PartialAsync("_inboxMessagesPartial",Model.Messages)
                        </div>
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
                            <div class="row">
                            <div style="margin-bottom: 3%;" class="d-flex justify-content-between">
                                <h3>All Order Portraits<span>( @Model.MyOrders.Count )</span></h3>
                                <a asp-action="ExportAsExcell" class="btn btn-dark">Exel Download</a>
                                </div>
                                <hr />
                                <div id="profilemyorderscontainerforloadmore">
                                    @foreach (var item in Model.MyOrders)
                                    {
                                        <div style="border-bottom: 1px solid black;padding: 3rem;align-items: center;text-align: center;" class="row row-cols-5">
                                            <img src="~/Uploads/Portraits/@item.Portrait.PortraitImages.FirstOrDefault(x=>x.ImageStatus==true).Image" alt="">
                                            <h3>@item.Portrait.Name</h3>
                                            <div>@item.CreatAt</div>
                                            <div>$@item.Price</div>
                                            <div><span class="badge bg-dark">@item.Status</span></div>
                                        </div>
                                    }
                                </div>                               
                            </div>
                            @if(Model.OrderCount.Count>3){
                                <div style="display: flex;justify-content: center;padding-top: 5%;">
                                    <a asp-action="GetMyOrdersforloadmore" asp-controller="Account" commentCount="@Model.OrderCount.Count" takeCount="3" skipCount="0" class="loadmore-btn-for-myorders btn btn-dark">Load More</a>
                                </div>
                            }                           
                        </div>
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade" id="v-pills-wishlist" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                            <div id="wihslistcontainer">
                                 @await Html.PartialAsync("_profileWishlistPartial",Model.WishListItem)
                            </div>  
                            @if(Model.Wishlistitemscount.Count>3){
                                <div style="display: flex;justify-content: center;padding-top: 5%;">
                                    <a asp-action="Getwishlistitemsforloadmore" asp-controller="Account" commentCount="@Model.Wishlistitemscount.Count" takeCount="3" skipCount="0" class="loadmore-btn btn btn-dark">Load More</a>
                                </div>
                            }                           
                        </div>
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade show active" id="my-v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                            <div>
                                @await Html.PartialAsync("_profilePortraitPartial",Model.Portraits)
                            </div>
                            @if(Model.Portraitscount.Count>3){
                                <div style="display: flex;justify-content: center;padding-top: 5%;">
                                    <a asp-action="GetPortraitsforloadmore" asp-controller="Account" commentCount="@Model.Portraitscount.Count" takeCount="3" skipCount="0" class="loadmore-btn-for-portraits btn btn-dark">Load More</a>
                                </div>
                            }                         
                        </div>
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade" id="v-pills-sale" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                        <div class="col-lg-12 grid-margin stretch-card">

                            <div>
                                <div class="d-flex justify-content-between">
                                    <h4 class="card-title">Sale Portraits</h4>
                                    <a asp-action="ExportAsExcell" class="btn btn-dark">Exel Download</a>
                                </div>
                               
                                <div class="table-responsive">
                                    <table class="table">

                                        <thead>
                                            <tr>

                                                <th> Client Name </th>
                                                <th> Product Price </th>
                                                <th> Portrait Name </th>
                                                <th> Start Date </th>
                                                <th> Order Status </th>
                                                <th> Actions </th>
                                            </tr>
                                        </thead>
                                        <tbody id="profileSaleorderscontainerforloadmore">
                                            @foreach (var item in Model.SaleOrders)
                                            {
                                                <tr>

                                                    <td>
                                                        @if (item.AppUser==null)
                                                        {
                                                            <span class="pl-2">@item.Fullname</span>
                                                        }
                                                        else{
                                                            <span class="pl-2">@item.AppUser.UserName</span>
                                                        }
                                                    </td>
                                                    <td> $@(((item.Portrait.SalePrice * (100 - item.Portrait.DiscountPercent) / 100)).ToString("0.00")) </td>
                                                    <td> @item.Portrait.Name </td>
                                                    <td> @item.CreatAt </td>
                                                    <td>
                                                        <div class="badge bg-dark">@item.Status</div>
                                                    </td>
                                                    @if (item.Status != OrderStatus.Pending)
                                                    {
                                                        <td>
                                                            <button type="button" class="btn btn-dark disabled">Edit</button>
                                                        </td>
                                                    }
                                                    else
                                                    {
                                                        <td>
                                                            <a asp-action="SaleOrderEdit" asp-route-id="@item.Id" type="button" class="btn btn-dark">Edit</a>
                                                        </td>
                                                    }

                                                </tr>
                                            }

                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </div>
                        @if(Model.SaleOrderCount.Count>3){
                           <div style="display: flex;justify-content: center;padding-top: 5%;">
                               <a asp-action="GetSaleOrdersforloadmore" asp-controller="Account" commentCount="@Model.Portraitscount.Count" takeCount="3" skipCount="0" class="loadmore-btn-for-sale-orders btn btn-dark">Load More</a>
                           </div>
                        }     
                        </div>
                        <div style="border: 1px solid #cecece;padding: 3rem;" class="tab-pane fade" id="v-pills-details" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                            <h3>
                                Account Details
                            </h3>
                            <hr>
                           @await Html.PartialAsync("_accountDetails",Model.ViewModel)
                        </div>

                    </div>
                </div>
        </section>
    </main>

    <input id="meyhiddenmessage" type="hidden" value="@ViewBag.admin"/>
    <input id="meyidihiddenmessage" type="hidden" value="@Model.User.Id"/>
    <input id="meynameihiddenmessage" type="hidden" value="@Model.User.Fullname"/>

    <script>
        ScrollReveal().reveal('.headline');

        function handleFileSelect(evt) {
            var file = evt.target.files; // FileList object
            var f = file[0];
            // Only process image files.
            if (!f.type.match('image.*')) {
                alert("Image only please....");
            }
            var reader = new FileReader();
            // Closure to capture the file information.
            reader.onload = (function (theFile) {
                return function (e) {
                    // Render thumbnail.
                    //var span = document.createElement('span');
                    //span.innerHTML = ['<img style="width: 10rem;margin-bottom: 15px;border-radius: 16%; " class="thumb" title="', escape(theFile.name), '" src="', e.target.result, '" />'].join('');
                    //document.getElementById('output').insertBefore(span, null);
                    document.getElementById('myOutput').innerHTML = ['<img style="width: 25%;margin-bottom: 15px;border-radius: 16%; " class="thumb" title="', escape(theFile.name), '" src="', e.target.result, '" />'].join('');
                };
            })(f);
            // Read in the image file as a data URL.
            reader.readAsDataURL(f);
        }
        document.getElementById('formFileMultiple').addEventListener('change', handleFileSelect, false);


    function handleFileSelectt(event) {
        //Check File API support
        if (window.File && window.FileList && window.FileReader) {

            var files = event.target.files; //FileList object
            var output = document.getElementById("myManyOutput");

            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                //Only pics
                if (!file.type.match('image')) continue;

                var picReader = new FileReader();
                picReader.addEventListener("load", function (event) {
                    var picFile = event.target;
                    var div = document.createElement("div");
                    document.getElementById("myManyOutput").innerHTML += "<img class='thumbnail my-first-backend-class' src='" + picFile.result + "'" + "title='" + file.name + "'/>";
                    output.insertBefore(div, null);
                });
                //Read the image
                picReader.readAsDataURL(file);
            }
        } else {
            console.log("Your browser does not support File API");
        }
    }

    document.querySelector('.formFileMultiple2').addEventListener('change', handleFileSelectt, false);

    </script>

   
@section Scripts{
    <script>

        document.getElementById("userMessageSenderinmine").addEventListener("click", function (e) {
            e.preventDefault();
            var message = document.getElementById("usermessageinput").value;
            var name = document.getElementById("meynameihiddenmessage").value;
            var image = document.getElementById("usermessageimagesend").value;
            var hiddenmesage = document.getElementById("meyhiddenmessage").value;
            var mayid = document.getElementById("meyidihiddenmessage").value;
            connection.invoke("SendMessageUser", name, message, hiddenmesage, mayid, image);

            var link = `/Account/InboxMessageSend?MyMessage=${message}`

            fetch(link)
                .then(response => {
                    return response.text();
                }).then(html => {

                })
        })

        connection.on("RecieveMessage", function (name, message) {
            var destination = document.getElementById("usermessageinboxconfirm");
            var image = document.getElementById("usermessageimagesend").value;
            destination.innerHTML += ` <div class="chat-message-right pb-4">
                                                <div class="ms-2">
                                                    <img src="/Uploads/Users/${image}" class="rounded-circle mr-1" alt="Chris Wood" width="40" height="40">
                                                </div>
                                                <div style="display: flex;align-items: center;" class="flex-shrink-1 bg-light rounded py-2 px-3 mr-3">
                                                   ${message}
                                                </div>
                                            </div>
                `
            document.getElementById('usermessageinput').value = "";
        })


        connection.on("RecievMessage", function (name, message) {
            var destination = document.getElementById("usermessageinboxconfirm");
            destination.innerHTML += `  <div class="chat-message-left pb-4">
                                                <div class="me-2">
                                                    <img src="/assets/images/4f64c9f81bb0d4ee969aaf7b4a5a6f40.png" class="rounded-circle mr-1" alt="Sharon Lessman" width="40" height="40">
                                                </div>
                                                <div class="flex-shrink-1 bg-light rounded py-2 px-3 ml-3">
                                                    <div class="font-weight-bold mb-1">Admin</div>
                                                    ${message}
                                                </div>
                                            </div>
                `
        })

    </script>
}